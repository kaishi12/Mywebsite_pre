@model IEnumerable<MyWebsite.ViewModels.Manga.MangaModel>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutUser.cshtml";
}
<style>
</style>
<div class="padding">
    <div class="m-b primary">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/Account/Home">Trang chủ</a></li>
            <li class="breadcrumb-item active">Danh sách truyện đã tạo</li>
        </ol>
    </div>

    <div style="top:6px">
        <button class="btn btn-default col-md-2 offset-md-10" data-toggle="modal" data-target="#AddModal">Thêm thể loại</button>
    </div>
    <br />
    <div class="box black">

        <div class="box-body">
            <div class="table-responsive">
                <table ui-jp="dataTable" id="datatable" class="table table-striped b-t b-b black">
                    <thead>
                        <tr>
                            <th style="text-align:center">STT</th>
                            <th style="text-align:center">Tên</th>
                            <th style="text-align:center">Code</th>
                            <th style="text-align:center">Alias</th>
                            <th style="text-align:center">Mô tả</th>
                            <th style="text-align:center"></th>

                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>
<div id="EditModal" class="modal" data-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 id="GenreName" class="modal-title">Modal</h5>
                <input type="hidden" id="GenreId" />
            </div>
            <div class="modal-body text-center p-lg">
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Tên thể loại</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="nameEdit" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Code</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="codeEdit" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Alias</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="aliasEdit" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Mô tả</span>
                    </label>
                    <div class="col-sm-8">
                        <textarea style="width:100%" id="desEdit" rows="4"></textarea>
                    </div>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">Thoát</button>
                <button type="button" class="btn danger p-x-md" id="SaveEdit">Chỉnh sửa</button>
            </div>
        </div><!-- /.modal-content -->
    </div>
</div>
<div id="AddModal" class="modal" data-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thêm thể loại</h5>
            </div>
            <div class="modal-body text-center p-lg">
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Tên thể loại</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="name" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Code</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="code" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Alias</span>
                    </label>
                    <div class="col-sm-8">

                        <input id="alias" class="form-control" />
                    </div>

                </div>
                <div class="form-group row">
                    <label class="col-sm-4 form-control-label">
                        <span>Mô tả</span>
                    </label>
                    <div class="col-sm-8">
                        <textarea style="width:100%" id="des" rows="4"></textarea>
                    </div>

                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn dark-white p-x-md" data-dismiss="modal">Thoát</button>
                <button type="button" class="btn danger p-x-md" id="SaveAdd">Thêm</button>
            </div>
        </div><!-- /.modal-content -->
    </div>
</div>
<script>
     $(document).ready(function () {
            loadEmpGroup();
     });
     function loadEmpGroup() {

            $.ajax({
                type: 'POST',
                url: '/Genres/GetAllListGenre',

                success: function (result) {
                    initTimeFrameDatatable(result);
                }
            });
        }
    function initTimeFrameDatatable(data) {
            $("#datatable").dataTable().fnDestroy();
            $("#datatable").dataTable({
                stateSave: true,
                "bFilter": true,
                "bSort": false,
                "data": data,
                "bRetrieve": true,
                "bScrollCollapse": true,
                "bProcessing": true,
                "oLanguage": {
                    "sSearch": "Tìm kiếm:",
                    "sSearchPlaceholder": "Nhân viên",
                    "sZeroRecords": "Không có dữ liệu phù hợp",
                    "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                    "sEmptyTable": "Không có dữ liệu",
                    "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                    "sLengthMenu": "Hiển thị _MENU_ dòng",
                    "sProcessing": "Đang xử lý...",
                    "oPaginate": {
                        "sNext": "<i class='fa fa-chevron-right'></i>",
                        "sPrevious": "<i class='fa fa-chevron-left'></i>"
                    }
                },
                "aoColumnDefs": [
                    {
                        "aTargets": [0, 1, 2,3,4],
                        "sClass": "text-center",
                        "bSortable": false
                    },
                     {
                        "aTargets": [5],
                        "mRender": function (data, type, row) {
                            var edit =
                                "<a title='Chi tiết' class='btn btn-sm btn-primary' onclick='showEditModal(" +
                                data +
                                ")'>Chi tiết</a>";
                            var del =
                                "<a title='Xóa' class='btn btn-sm btn-primary' onclick='Delete(" +
                                data +
                                ")'>Xóa</a>";
                            return edit + " " + del ;
                        },
                    }
                ],
                "bAutoWidth": false,
            });

    }
    function showEditModal(id) {
         $.ajax({
                type: 'POST',
                url: '@Url.Action("PrepareEdit", "Genres")',
             data: {
                 Id: id
             },
             success: function (result) {
                 console.log(result);
                 $("#GenreName").text(result.name);
                 $("#GenreId").val(result.id);
                 $("#nameEdit").val(result.name);
                 $("#codeEdit").val(result.code);
                 $("#aliasEdit").val(result.alias);
                 $("#desEdit").val(result.des);
                }
            });
         $('#EditModal').modal('show');

    }
    function ResetEditModal() {
         $("#GenreName").text("Thể loại");
         $("#GenreId").val("");
         $("#nameEdit").val("");
        $("#codeEdit").val("");
        $("#aliasEdit").val("");
        $("#desEdit").val("");
    }
    function ResetAddModal() {
         $("#name").val("");
        $("#code").val("");
        $("#alias").val("");
        $("#des").val("");
    }
    $("#SaveEdit").on("click", function () {
         if ($('#nameEdit').val() == "") {
            alert("Vui lòng nhập tên thể loại");
                return;
            }
             if ($('#codeEdit').val() == "") {
            alert("Vui lòng nhập code");
                return;
            }
            if ($('#aliasEdit').val() == "") {
            alert("Vui lòng nhập alias");
                return;
            }
             if ($('#desEdit').val() == "") {
            alert("Vui lòng nhập mô tả");
                return;
        }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("Edit", "Genres")',
                data: {
                    'id': +$("#GenreId").val(),
                    'name': $("#nameEdit").val(),
                    'code': $("#codeEdit").val(),
                    'des': $("#desEdit").val(),
                    'alias': $("#aliasEdit").val()

                },
                success: function(result) {
                    if (result.rs == true) {
                        alert(result.mess);
                        $('#EditModal').modal('hide');
                        ResetEditModal();
                    } else {
                        alert(result.mess);
                    }
                },
                error: function(error) {
                    ShowAlert("Có lỗi xảy ra, vui lòng thử lại", 1);
                }
            });
    })
      $("#SaveAdd").on("click", function () {
         if ($('#name').val() == "") {
            alert("Vui lòng nhập tên thể loại");
                return;
            }
             if ($('#code').val() == "") {
            alert("Vui lòng nhập code");
                return;
            }
            if ($('#alias').val() == "") {
            alert("Vui lòng nhập alias");
                return;
            }
             if ($('#des').val() == "") {
            alert("Vui lòng nhập mô tả");
                return;
        }
            $.ajax({
                type: 'POST',
                url: '@Url.Action("Add", "Genres")',
                data: {
                    'name': $("#name").val(),
                    'code': $("#code").val(),
                    'des': $("#des").val(),
                    'alias': $("#alias").val()
                },
                success: function(result) {
                    if (result.rs == true) {
                        alert(result.mess);
                        loadEmpGroup();
                        $('#AddModal').modal('hide');
                        ResetAddModal();
                    } else {
                        alert(result.mess);
                    }
                },
                error: function(error) {
                    ShowAlert("Có lỗi xảy ra, vui lòng thử lại", 1);
                }
            });
      })
    function Delete(id) {

        var r = confirm("Bạn có muốn xóa thể loại này?");
            if (r == true) {
                    $.ajax({
                        type: 'POST',
                        url: '@Url.Action("DeleteGen", "Genres")',
                        data: {
                            'id': id,
                        },
                        success: function(data) {
                            if (data.rs) {
                                alert(data.mess);
                                loadEmpGroup();
                            } else {
                                alert(data.mess);
                            }
                        },
                        error: function (error) {
                            alert(data.mess);
                        }
                    });
}
    }
</script>
